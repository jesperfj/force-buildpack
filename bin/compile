#!/bin/sh

BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3

indent() {
  sed -u 's/^/       /'
}

echo "-----> Force project"

cd $BUILD_DIR
export HOME=$BUILD_DIR

echo "-----> Installing CLI..."
curl -s https://developer.salesforce.com/media/salesforce-cli/sfdx-v5.6.22-f9533ba-linux-amd64.tar.xz | tar xJf -
mkdir -p .local/share
mv heroku .local/share/heroku
export PATH=$PATH:$HOME/.local/share/heroku/bin
echo "-----> Installing Force Plugin..."
sfdx plugins:install salesforce-alm

mkdir .profile.d
echo 'PATH=$PATH:$HOME/.local/share/heroku/bin' > .profile.d/force-defaults.sh
echo 'SFDX_DISABLE_ENCRYPTION=true' >> .profile.d/force-defaults.sh
echo 'curl -s $FORCE_DEVHUB_AUTH_URL | tar -C $HOME/.sfdx x -' >> .profile.d/force-defaults.sh
